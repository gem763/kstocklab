# AGENTS.md

이 저장소는 한국 주식 일별 데이터를 이용해 자율 패턴 연구를 수행합니다.

## 목표

- 연구 시작 지시를 받으면 후보 생성부터 검증까지 전체 사이클을 실행합니다.
- 인샘플 적합보다 OOS(Out-of-Sample) 품질을 우선해 패턴을 순위화합니다.
- 코드/설정/리포트/ledger 갱신이 모두 재현 가능하게 남아야 합니다.

## 필수 입력

- 레거시 참고 자료: `static/패턴은 정말 존재하는가.pdf`
- 시장 데이터: `data/` 아래 parquet 파일

## 연구 규칙

- 정적 문헌 증거는 항상 레거시(주로 2000~2012 맥락)로 취급합니다.
- 레거시 결과가 현재 시장 구조에서도 유효하다고 가정하지 않습니다.
- 모든 후보 패턴은 워크포워드 OOS 방식으로 재검증합니다.
- 장기 평균 지표만 보지 않고, OOS 분할 구간별로 단기/장기 통계 차이와 연속 부진 구간(인내구간)을 함께 평가합니다.
- 필요 시 EWMA 등 시계열 가중 통계를 사용해 최근 유효성 저하/개선을 점검합니다.
- 웹 접근이 가능하고 최신 근거가 필요하면 최근 논문/자료를 찾고 출처를 기록합니다.
- 모든 가정과 모델 선택 이유를 리포트에 명시합니다.

## 재현성 규칙

- 실행 엔트리포인트는 `python -m research.run --config ...` 를 사용합니다.
- 핵심 파라미터는 `configs/*.yaml`에서만 관리합니다.
- 결과는 `reports/YYYY-MM-DD*` 날짜 폴더(`-1`, `-2` suffix 포함 가능)에 저장합니다.
- 상위 검증 결과는 `research/memory/ledger.parquet`에 반영합니다.
- `research/memory/backlog.md`, `research/memory/lessons.md`를 업데이트합니다.
- 종료 조건은 아래 둘 중 하나입니다:
  - 최종 단계 후보 평가가 완료됨
  - 설정된 시간 예산(`research.max_minutes`)에 도달함

## 효율 규칙

- 문헌 캐시(`literature.cache_path`)가 있으면 매 실행마다 동일 PDF를 재파싱하지 않습니다.
- 캐시 갱신은 명시적으로 요청된 경우(`literature.refresh_cache: true`)에만 수행합니다.

## 품질 가드레일

- 신호/수익률 정렬에서 룩어헤드 누수를 방지합니다.
- 백테스트 지표에 거래비용과 슬리피지를 반영합니다.
- 과도한 추상화보다 단순하고 읽기 쉬운 모듈 구성을 우선합니다.
